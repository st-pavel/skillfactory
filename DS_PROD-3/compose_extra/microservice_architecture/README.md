# Микросервисная архитектура для прогнозирования диабета

Этот проект реализует простую микросервисную архитектуру для эмуляции работы ML-продукта в продакшене. Комплекс сервисов генерирует данные, выполняет предсказания моделью, вычисляет метрики и строит графики распределения ошибок.

## Описание сервисов

Архитектура состоит из 5 контейнеров, взаимодействующих через RabbitMQ:

1.  **rabbitmq**: Брокер сообщений для асинхронного обмена данными между сервисами.
2.  **features**: 
    - Эмулирует поток данных.
    - Берет случайную запись из датасета Diabetes (sklearn).
    - Отправляет вектор признаков в очередь `features`.
    - Отправляет истинное значение целевой переменной в очередь `y_true`.
3.  **model**:
    - Подписана на очередь `features`.
    - При получении вектора признаков десериализует обученную модель (`myfile.pkl`).
    - Выполняет предсказание.
    - Отправляет результат в очередь `y_pred`.
4.  **metric**:
    - Подписана на очереди `y_true` и `y_pred`.
    - Объединяет истинные значения и предсказания по ID сообщения.
    - Вычисляет абсолютную ошибку (Absolute Error).
    - Логирует результаты в файл `./logs/metric_log.csv`.
5.  **plot**:
    - Бесконечно считывает файл `./logs/metric_log.csv`.
    - Строит и обновляет гистограмму распределения ошибок.
    - Сохраняет график в файл `./logs/error_distribution.png`.

## Структура проекта

```
microservice_architecture/
├── docker-compose.yml    # Конфигурация запуска сервисов
├── features/             # Сервис генерации признаков
├── model/                # Сервис модели машинного обучения
├── metric/               # Сервис расчета метрик
├── plot/                 # Сервис визуализации
└── logs/                 # Общая папка для логов и графиков (bind mount)
    ├── metric_log.csv    # Лог метрик
    └── error_distribution.png # График распределения ошибок
```

## Запуск проекта

Для запуска всех сервисов выполните команды:

```bash
# Сборка образов
docker-compose build

# Запуск контейнеров в фоновом режиме
docker-compose up -d
```

## Просмотр результатов

После запуска сервисы начнут работать автоматически. Результаты работы можно найти в папке `logs`:

- **metric_log.csv**: Таблица с полями `id`, `y_true`, `y_pred`, `absolute_error`.
- **error_distribution.png**: Гистограмма абсолютных ошибок модели.

## Остановка

Чтобы остановить работу сервисов и удалить контейнеры:

```bash
docker-compose down
```

## Примечания

Если возникают ошибки библиотек `pandas` или `numpy`, убедитесь, что в `requirements.txt` сервисов `metric` и `plot` зафиксированы совместимые версии (например, `numpy==1.23.4`, `pandas==1.5.0`).
